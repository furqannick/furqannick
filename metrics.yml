name: Generate GitHub Profile Metrics

on:
  schedule:
    - cron: '0 */12 * * *'  # every 12 hours
  workflow_dispatch:

jobs:
  metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: Generate metrics
        id: GenerateMetrics
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: furqannick
          base: header, activity, community, repositories, metadata
          plugins: |
            languages
            contributions
            commits
            discussions
            notable
            people
            stars
            topics
            music
            anime
            skyline
            calendar
          config_display: large
          config_padding: 8, 16
          config_octicon: true
          config_twemoji: true

      - name: Commit generated files
        if: ${{ steps.GenerateMetrics.outputs.changed == 'true' || steps.GenerateMetrics.outputs.changed == 'True' }}
        uses: ad-m/github-push-action@v0.6.0
        with:
          github_token: ${{ secrets.METRICS_TOKEN }}
          branch: ${{ github.ref_name || 'main' }}
